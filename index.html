<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web3 Launchpad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.11.1/ethers.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        @keyframes pulse-blue {
            0%, 100% { background-color: #e0f2fe; }
            50% { background-color: #bae6fd; }
        }
        .status-active { animation: pulse-blue 2s infinite; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        const { ethers } = window;

        // Icons
        const WalletIcon = ({ size = 20, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4"/><path d="M4 6v12c0 1.1.9 2 2 2h14v-4"/><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h2v-4Z"/></svg>;
        const CoinsIcon = ({ size = 20, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></svg>;
        const PlayIcon = ({ size = 20, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 3 19 12 5 21 5 3"/></svg>;
        const RefreshIcon = ({ size = 20, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>;
        const CheckCircleIcon = ({ size = 20, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>;
        const LoaderIcon = ({ size = 20, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`animate-spin ${className}`}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>;
        const SettingsIcon = ({ size = 20, className = "" }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;

        const FACTORY_ADDRESS = "0x381dd293A5dE117D0466Ab56f8A4af6237CbCf23";
        const ERC20_ABI = ["function name() view returns (string)", "function symbol() view returns (string)", "function decimals() view returns (uint8)", "function balanceOf(address) view returns (uint256)", "function approve(address spender, uint256 amount) returns (bool)", "function allowance(address owner, address spender) view returns (uint256)"];
        const FACTORY_ABI = ["function createProject(uint256 _startBlock, uint256 _endBlock, address _presaleToken, uint256 _presaleAmount, address _baseToken, uint256 _tokenExchangeRate, address _adminAddress, uint256 _minHeldNum)", "function getAllProjectlist() view returns (address[])", "function isWhitelisted(address user) view returns (bool)"];
        const PROJECT_ABI = ["function product() view returns (uint256, uint256, address, address, uint256, uint256, uint256, uint256, address, uint256)", "function setting() view returns (uint256, uint256, bool, bool)", "function buyToken(uint256 amount)", "function addCandy(uint256 amount)", "function updateSetting(uint256 _maxBuy, uint256 _minPerBuy)", "function pauseProject()", "function resumeProject()"];

        const Card = ({ children, className = "" }) => <div className={`bg-white rounded-xl shadow-md border border-gray-100 p-6 ${className}`}>{children}</div>;
        const Button = ({ onClick, disabled, children, variant = "primary", className = "" }) => {
            const variants = { primary: "bg-blue-600 text-white hover:bg-blue-700 disabled:bg-blue-300", secondary: "bg-gray-100 text-gray-700 hover:bg-gray-200 disabled:bg-gray-100", warning: "bg-yellow-500 text-white hover:bg-yellow-600" };
            return <button onClick={onClick} disabled={disabled} className={`px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2 ${variants[variant]} ${className}`}>{children}</button>;
        };

        function LaunchpadApp() {
            const [account, setAccount] = useState("");
            const [provider, setProvider] = useState(null);
            const [signer, setSigner] = useState(null);
            const [isWhitelisted, setIsWhitelisted] = useState(false);
            const [projects, setProjects] = useState([]);
            const [loading, setLoading] = useState(false);
            const [showCreateForm, setShowCreateForm] = useState(false);
            const [currentBlock, setCurrentBlock] = useState(0);
            const [statusMsg, setStatusMsg] = useState(""); 
            const [refreshTrigger, setRefreshTrigger] = useState(0); 
            
            const [formData, setFormData] = useState({ presaleToken: "", baseToken: "", presaleAmount: "", tokenDecimals: "18", exchangeRate: "", startBlock: "", endBlock: "", minHeld: "0" });

            const connectWallet = async () => {
                if (window.ethereum) {
                    try {
                        const _provider = new ethers.BrowserProvider(window.ethereum);
                        const _signer = await _provider.getSigner();
                        const _account = await _signer.getAddress();
                        setProvider(_provider); setSigner(_signer); setAccount(_account);
                        const block = await _provider.getBlockNumber();
                        setCurrentBlock(block);
                        checkWhitelist(_account, _provider);
                    } catch (err) { alert("è¿æ¥å¤±è´¥: " + err.message); }
                } else { alert("è¯·å®‰è£… MetaMask!"); }
            };

            const checkWhitelist = async (userAddress, providerInstance) => {
                try {
                    const factory = new ethers.Contract(FACTORY_ADDRESS, FACTORY_ABI, providerInstance);
                    const status = await factory.isWhitelisted(userAddress);
                    setIsWhitelisted(status);
                } catch (err) { console.error(err); }
            };

            const fetchProjects = async () => {
                if (!provider) return;
                setLoading(true);
                try {
                    const block = await provider.getBlockNumber();
                    setCurrentBlock(block);
                    const factory = new ethers.Contract(FACTORY_ADDRESS, FACTORY_ABI, provider);
                    const projectAddresses = await factory.getAllProjectlist();
                    
                    const projectDataPromises = projectAddresses.map(async (addr) => {
                        try {
                            const projectContract = new ethers.Contract(addr, PROJECT_ABI, provider);
                            const product = await projectContract.product();
                            const setting = await projectContract.setting();
                            
                            let tokenSymbol = "TOKEN", presaleDecimals = 18;
                            try {
                                const tokenContract = new ethers.Contract(product[2], ERC20_ABI, provider);
                                tokenSymbol = await tokenContract.symbol();
                                presaleDecimals = Number(await tokenContract.decimals());
                            } catch (e) {}

                            let baseDecimals = 18, baseSymbol = "BASE";
                            try {
                                const baseTokenContract = new ethers.Contract(product[3], ERC20_ABI, provider);
                                baseDecimals = Number(await baseTokenContract.decimals());
                                baseSymbol = await baseTokenContract.symbol();
                            } catch(e) {}

                            let contractBalance = "0";
                            try {
                                const tokenContract = new ethers.Contract(product[2], ERC20_ABI, provider);
                                const balanceWei = await tokenContract.balanceOf(addr);
                                contractBalance = ethers.formatUnits(balanceWei, presaleDecimals);
                            } catch(e) {}

                            return {
                                address: addr,
                                startBlock: product[0].toString(),
                                endBlock: product[1].toString(),
                                presaleToken: product[2],
                                baseToken: product[3],
                                presaleAmount: ethers.formatUnits(product[4], presaleDecimals),
                                saleAmount: ethers.formatUnits(product[5], presaleDecimals),
                                exchangeRate: product[7].toString(),
                                admin: product[8],
                                paused: setting[2],
                                tokenSymbol, baseSymbol, baseDecimals, presaleDecimals,
                                minPerBuy: setting[1], maxBuy: setting[0], contractBalance
                            };
                        } catch (err) { return null; }
                    });
                    const results = await Promise.all(projectDataPromises);
                    setProjects(results.filter(p => p !== null));
                } catch (err) { console.error(err); } finally { setLoading(false); }
            };

            useEffect(() => {
                if (provider) {
                    fetchProjects();
                    const interval = setInterval(async () => { try { const block = await provider.getBlockNumber(); setCurrentBlock(block); } catch(e) {} }, 15000);
                    return () => clearInterval(interval);
                }
            }, [provider, refreshTrigger]);

            const autofillBlocks = async () => {
                if (!provider) return;
                const block = await provider.getBlockNumber();
                setCurrentBlock(block);
                const buffer = 200, duration = 7200;
                setFormData({ ...formData, startBlock: (block + buffer).toString(), endBlock: (block + buffer + duration).toString() });
            };

            const handleCreateProject = async () => {
                if (!signer) return;
                try {
                    setStatusMsg("ğŸ” æ£€æŸ¥åŒºå—...");
                    const latestBlock = await provider.getBlockNumber();
                    let finalStart = BigInt(formData.startBlock), finalEnd = BigInt(formData.endBlock);
                    if (finalStart <= BigInt(latestBlock) + 50n) {
                        if (!confirm("âš ï¸ å¼€å§‹æ—¶é—´å¯èƒ½å·²è¿‡æœŸï¼Œæ˜¯å¦è‡ªåŠ¨ä¿®æ­£ä¸ºæœ€æ–°åŒºå— + 200ï¼Ÿ")) { setStatusMsg(""); return; }
                        finalStart = BigInt(latestBlock) + 200n; finalEnd = finalStart + 7200n;
                    }
                    const decimals = parseInt(formData.tokenDecimals || "18");
                    const amountWei = ethers.parseUnits(formData.presaleAmount, decimals);
                    
                    setStatusMsg("ğŸš€ å‘èµ·åˆ›å»ºäº¤æ˜“...");
                    const factory = new ethers.Contract(FACTORY_ADDRESS, FACTORY_ABI, signer);
                    const tx = await factory.createProject(finalStart, finalEnd, formData.presaleToken, amountWei, formData.baseToken, BigInt(formData.exchangeRate), account, BigInt(formData.minHeld), { gasLimit: 6000000 });
                    setStatusMsg("â³ éƒ¨ç½²ä¸­...");
                    await tx.wait();
                    setStatusMsg("âœ… æˆåŠŸï¼è¯·å»åˆ—è¡¨ä¸­å……å€¼ã€‚");
                    setTimeout(() => { setShowCreateForm(false); setStatusMsg(""); fetchProjects(); }, 2000);
                } catch (err) { setStatusMsg(""); alert(err.reason || err.message); }
            };

            const AdminSettings = ({ project, onClose }) => {
                const [candyAmount, setCandyAmount] = useState("");
                const [working, setWorking] = useState(false);
                const fillGap = () => {
                    const gap = parseFloat(project.presaleAmount) - parseFloat(project.contractBalance);
                    setCandyAmount(gap > 0 ? gap.toString() : "0");
                };
                const handleAddCandy = async () => {
                    if (!signer) return;
                    setWorking(true);
                    try {
                        const projectContract = new ethers.Contract(project.address, PROJECT_ABI, signer);
                        const tokenContract = new ethers.Contract(project.presaleToken, ERC20_ABI, signer);
                        const amountWei = ethers.parseUnits(candyAmount, project.presaleDecimals);
                        setStatusMsg("ğŸ” æˆæƒè½¬å…¥...");
                        const approveTx = await tokenContract.approve(project.address, amountWei);
                        await approveTx.wait();
                        setStatusMsg("ğŸ¬ æ³¨å…¥ä»£å¸...");
                        const addTx = await projectContract.addCandy(amountWei);
                        await addTx.wait();
                        alert("å……å€¼æˆåŠŸï¼"); fetchProjects(); setCandyAmount("");
                    } catch (err) { alert(err.reason || err.message); } finally { setWorking(false); setStatusMsg(""); }
                };
                return (
                    <div className="mt-4 p-4 bg-gray-50 rounded border border-gray-200">
                        <h4 className="font-bold text-sm mb-2 text-gray-700">âš™ï¸ ç®¡ç†å‘˜è®¾ç½®</h4>
                        <div className="bg-white p-3 rounded border border-blue-100 mb-3">
                            <h5 className="text-xs font-bold text-blue-600 mb-2">ğŸ¬ é¢„å”®èµ„é‡‘æ±  (Candy)</h5>
                            <div className="flex justify-between text-xs text-gray-500 mb-1">
                                <span>ç›®æ ‡: {project.presaleAmount}</span>
                                <span className={parseFloat(project.contractBalance) < parseFloat(project.presaleAmount) ? "text-red-500 font-bold" : "text-green-600"}>å½“å‰: {project.contractBalance}</span>
                            </div>
                            <div className="flex gap-2">
                                <input className="flex-1 border p-1 rounded text-sm" placeholder="è¾“å…¥å……å€¼æ•°é‡" value={candyAmount} onChange={e => setCandyAmount(e.target.value)} />
                                <button onClick={fillGap} className="text-xs text-blue-500 underline">è¡¥é½</button>
                            </div>
                            <Button onClick={handleAddCandy} disabled={working} variant="warning" className="w-full mt-2 text-xs py-1">{working ? "å……å€¼ä¸­..." : "æ³¨å…¥ä»£å¸ (AddCandy)"}</Button>
                        </div>
                        <div className="flex justify-end"><Button onClick={onClose} variant="secondary" className="text-xs py-1">å…³é—­</Button></div>
                    </div>
                );
            };

            const ProjectCard = ({ project, currentBlock }) => {
                const [buyAmount, setBuyAmount] = useState("");
                const [buying, setBuying] = useState(false);
                const [userBalance, setUserBalance] = useState("0");
                const [showSettings, setShowSettings] = useState(false);

                const startBlock = parseInt(project.startBlock), endBlock = parseInt(project.endBlock);
                const isStarted = currentBlock >= startBlock, isEnded = currentBlock > endBlock;
                const minBuyReadable = ethers.formatUnits(project.minPerBuy, project.baseDecimals);
                const isAdmin = account && (account.toLowerCase() === project.admin.toLowerCase());

                // è®¡ç®—é¢„è®¡è·å¾—æ•°é‡
                const estimatedOutput = buyAmount && project.exchangeRate 
                    ? (parseFloat(buyAmount) * parseFloat(project.exchangeRate)).toFixed(2) 
                    : "0";
                
                // æ£€æŸ¥åº“å­˜æ˜¯å¦è¶³å¤Ÿæœ¬æ¬¡è´­ä¹°
                const isStockEnough = parseFloat(project.contractBalance) >= parseFloat(estimatedOutput);

                useEffect(() => {
                    if (account && project.baseToken && provider) {
                        const fetchBalance = async () => {
                            try {
                                const tokenContract = new ethers.Contract(project.baseToken, ERC20_ABI, provider);
                                const bal = await tokenContract.balanceOf(account);
                                setUserBalance(ethers.formatUnits(bal, project.baseDecimals));
                            } catch(e) {}
                        };
                        fetchBalance();
                    }
                }, [account, project.baseToken, refreshTrigger]);

                const handleBuy = async () => {
                    if (!signer) return alert("è¯·å…ˆè¿æ¥é’±åŒ…");
                    if (parseFloat(buyAmount) < parseFloat(minBuyReadable)) return alert(`è´­ä¹°é‡ä¸èƒ½ä½äº ${minBuyReadable} ${project.baseSymbol}`);
                    if (!isStockEnough) return alert(`åº“å­˜ä¸è¶³ï¼ä½ æƒ³è¦ä¹° ${estimatedOutput} ä¸ªï¼Œä½†åº“å­˜åªæœ‰ ${project.contractBalance} ä¸ªã€‚è¯·å‡å°‘è´­ä¹°é‡æˆ–è”ç³»ç®¡ç†å‘˜å……å€¼ã€‚`);

                    setBuying(true);
                    try {
                        const projectContract = new ethers.Contract(project.address, PROJECT_ABI, signer);
                        const baseTokenContract = new ethers.Contract(project.baseToken, ERC20_ABI, signer);
                        const amountWei = ethers.parseUnits(buyAmount, project.baseDecimals);

                        console.log("Approving...");
                        setStatusMsg(`æˆæƒ ${buyAmount} ${project.baseSymbol}...`);
                        const approveTx = await baseTokenContract.approve(project.address, amountWei);
                        await approveTx.wait();
                        
                        console.log("Buying...");
                        setStatusMsg(`è´­ä¹°ä¸­...`);
                        const buyTx = await projectContract.buyToken(amountWei);
                        await buyTx.wait();
                        
                        alert(`ğŸ‰ è´­ä¹°æˆåŠŸï¼è·å¾— ${estimatedOutput} ${project.tokenSymbol}`);
                        setRefreshTrigger(p => p+1); fetchProjects();
                    } catch (err) { 
                        let msg = err.reason || err.message;
                        if (msg.includes("Sold out")) msg = "é”™è¯¯ï¼šåº“å­˜ä¸è¶³ (Sold Out)ï¼Œè¯·è”ç³»ç®¡ç†å‘˜å……å€¼ï¼";
                        alert(msg); 
                    } finally { setBuying(false); setStatusMsg(""); }
                };

                return (
                    <Card className="hover:shadow-lg transition-shadow border-t-4 border-t-blue-500">
                        <div className="flex justify-between items-start mb-4">
                            <div>
                                <h3 className="text-xl font-bold text-gray-800">{project.tokenSymbol} IDO</h3>
                                <p className="text-xs text-gray-500 font-mono mt-1">åˆçº¦: {project.address.slice(0,6)}...{project.address.slice(-4)}</p>
                            </div>
                            <div className="flex flex-col items-end gap-1">
                                {!isStarted && <span className="bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded text-xs">â³ æœªå¼€å§‹</span>}
                                {isEnded && <span className="bg-gray-200 text-gray-600 px-2 py-0.5 rounded text-xs">ğŸ å·²ç»“æŸ</span>}
                                <span className={`px-2 py-1 rounded text-xs font-bold ${project.paused ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}`}>{project.paused ? 'æš‚åœä¸­' : 'è¿›è¡Œä¸­'}</span>
                            </div>
                        </div>

                        <div className="space-y-3 mb-6">
                            <div className="flex justify-between text-sm bg-blue-50 p-2 rounded">
                                <span className="text-blue-800 font-bold">1 {project.baseSymbol} = {project.exchangeRate} {project.tokenSymbol}</span>
                            </div>
                            <div className="flex justify-between text-sm text-gray-600">
                                <span>èµ·ä¹°é™åˆ¶:</span>
                                <span className="text-red-600 font-bold">{minBuyReadable} {project.baseSymbol}</span>
                            </div>
                            <div className="flex justify-between text-sm text-gray-600">
                                <span>å½“å‰åº“å­˜:</span>
                                <span className={isStockEnough ? "text-green-600" : "text-red-600 font-bold"}>{project.contractBalance} {project.tokenSymbol}</span>
                            </div>
                        </div>

                        <div className="flex flex-col gap-2">
                            <div className="flex justify-between text-xs text-gray-500">
                                <span>ä½™é¢: {parseFloat(userBalance).toLocaleString()} {project.baseSymbol}</span>
                                {buyAmount && <span className="text-blue-600 font-bold">â‰ˆ è·å¾— {estimatedOutput} {project.tokenSymbol}</span>}
                            </div>
                            <div className="flex gap-2">
                                <input type="number" placeholder={`Min ${minBuyReadable}`} value={buyAmount} onChange={(e) => setBuyAmount(e.target.value)} className="flex-1 border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
                                <Button onClick={handleBuy} disabled={buying || project.paused || !isStarted || isEnded} className="min-w-[80px]">
                                    {buying ? "..." : "è´­ä¹°"}
                                </Button>
                            </div>
                            {buyAmount && !isStockEnough && <p className="text-xs text-red-500 text-center">âš ï¸ è´­ä¹°é‡è¶…è¿‡å½“å‰åº“å­˜ï¼Œäº¤æ˜“å°†å¤±è´¥ï¼</p>}
                        </div>

                        {isAdmin && (
                            <div className="mt-4 pt-4 border-t border-gray-100">
                                <button onClick={() => setShowSettings(!showSettings)} className="flex items-center gap-1 text-xs text-gray-500 hover:text-blue-600">
                                    <SettingsIcon size={14} /> {showSettings ? "æ”¶èµ·" : "ç®¡ç†å‘˜å……å€¼"}
                                </button>
                                {showSettings && <AdminSettings project={project} onClose={() => setShowSettings(false)} />}
                            </div>
                        )}
                    </Card>
                );
            };

            return (
                <div className="max-w-6xl mx-auto p-8 relative">
                    {statusMsg && <div className="fixed top-0 left-0 w-full bg-blue-600 text-white p-3 text-center shadow-lg z-50 flex items-center justify-center gap-2"><LoaderIcon size={20} className="text-white" /><span className="font-bold">{statusMsg}</span></div>}
                    <div className="flex justify-between items-center mb-10 mt-8">
                        <div className="flex items-center gap-2"><div className="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white"><CoinsIcon size={24} /></div><h1 className="text-2xl font-bold tracking-tight">Web3 Launchpad</h1></div>
                        <div className="flex items-center gap-4">
                            {isWhitelisted && <span className="flex items-center gap-1 text-sm bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full border border-yellow-200"><CheckCircleIcon size={14} /> ç™½åå•ç”¨æˆ· (Creator)</span>}
                            {!account ? <Button onClick={connectWallet}><WalletIcon size={18} /> è¿æ¥é’±åŒ…</Button> : <div className="flex items-center gap-2 bg-white border px-4 py-2 rounded-lg"><div className="w-2 h-2 bg-green-500 rounded-full"></div><div className="flex flex-col items-end"><span className="text-sm font-mono text-gray-600">{account.slice(0, 6)}...{account.slice(-4)}</span><span className="text-xs text-blue-500">åŒºå—: {currentBlock}</span></div></div>}
                        </div>
                    </div>
                    <div className="space-y-8">
                        {account && isWhitelisted && (
                            <section>
                                <div className="flex justify-between items-end mb-4"><h2 className="text-xl font-bold text-gray-800">é¡¹ç›®ç®¡ç† (Admin)</h2><Button variant="outline" onClick={() => setShowCreateForm(!showCreateForm)}>{showCreateForm ? 'å–æ¶ˆåˆ›å»º' : <span><span className="inline-block mr-1 text-lg leading-none align-middle">+</span>åˆ›å»ºæ–°é¡¹ç›®</span>}</Button></div>
                                {showCreateForm && (
                                    <Card className="mb-8 border-blue-200 ring-4 ring-blue-50/50">
                                        <div className="flex justify-between items-center mb-4"><h3 className="font-bold text-lg">é…ç½®æ–° IDO é¡¹ç›®</h3><button onClick={autofillBlocks} className="text-xs bg-indigo-100 text-indigo-700 px-3 py-1 rounded hover:bg-indigo-200">âœ¨ ä¸€é”®å¡«å…… (ç¼“å†²+200å—)</button></div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div><label className="block text-sm text-gray-600 mb-1">é¢„å”®ä»£å¸åœ°å€ (Presale Token)</label><input className="w-full border p-2 rounded" placeholder="ä¾‹å¦‚: 0x... (ä½ å–çš„å¸)" onChange={e => setFormData({...formData, presaleToken: e.target.value})} /></div>
                                            <div><label className="block text-sm text-gray-600 mb-1">åŸºç¡€ä»£å¸åœ°å€ (USDT/Base)</label><input className="w-full border p-2 rounded" placeholder="ä¾‹å¦‚: 0x... (æ”¯ä»˜ç”¨çš„å¸)" onChange={e => setFormData({...formData, baseToken: e.target.value})} /></div>
                                            <div><label className="block text-sm text-gray-600 mb-1">é¢„å”®æ€»æ•°é‡</label><input type="number" className="w-full border p-2 rounded" placeholder="100000" onChange={e => setFormData({...formData, presaleAmount: e.target.value})} /></div>
                                            <div><label className="block text-sm text-gray-600 mb-1">ä»£å¸ç²¾åº¦ (Decimals)</label><select className="w-full border p-2 rounded bg-white" value={formData.tokenDecimals} onChange={e => setFormData({...formData, tokenDecimals: e.target.value})}><option value="18">18 (æ ‡å‡†ERC20)</option><option value="6">6 (USDT/USDC)</option><option value="8">8 (WBTC)</option></select><p className="text-xs text-gray-400 mt-1">æ³¨æ„ï¼šå¦‚æœä¸çŸ¥é“è¯·ä¿æŒ18ã€‚USDTæ˜¯6ã€‚</p></div>
                                            <div><label className="block text-sm text-gray-600 mb-1">æ±‡ç‡ (1 Base = ? Token)</label><input type="number" className="w-full border p-2 rounded" placeholder="100" onChange={e => setFormData({...formData, exchangeRate: e.target.value})} /></div>
                                            <div className="bg-gray-50 p-2 rounded"><label className="block text-sm text-gray-600 mb-1">å¼€å§‹åŒºå— (Start Block)</label><input type="number" className="w-full border p-2 rounded bg-white" placeholder={`å¿…é¡» > ${currentBlock}`} value={formData.startBlock} onChange={e => setFormData({...formData, startBlock: e.target.value})} /></div>
                                            <div className="bg-gray-50 p-2 rounded"><label className="block text-sm text-gray-600 mb-1">ç»“æŸåŒºå— (End Block)</label><input type="number" className="w-full border p-2 rounded bg-white" placeholder={`å»ºè®®: ${currentBlock + 7200}`} value={formData.endBlock} onChange={e => setFormData({...formData, endBlock: e.target.value})} /></div>
                                        </div>
                                        <div className="mt-6 flex justify-end"><Button onClick={handleCreateProject} disabled={!!statusMsg}>{statusMsg ? "æ“ä½œè¿›è¡Œä¸­..." : "ç¡®è®¤éƒ¨ç½²ä¸Šé“¾"}</Button></div>
                                    </Card>
                                )}
                            </section>
                        )}
                        <section>
                            <div className="flex justify-between items-center mb-6"><h2 className="text-xl font-bold text-gray-800 flex items-center gap-2"><PlayIcon size={20} className="text-blue-500" />æ­£åœ¨è¿›è¡Œçš„ IDO</h2><Button variant="secondary" onClick={fetchProjects} className="text-sm"><RefreshIcon size={14} className={loading ? "animate-spin" : ""} /> åˆ·æ–°åˆ—è¡¨</Button></div>
                            {projects.length === 0 ? <div className="text-center py-20 bg-white rounded-xl border border-dashed border-gray-300"><p className="text-gray-500">æš‚æ— é¡¹ç›®ï¼Œç­‰å¾…ç®¡ç†å‘˜åˆ›å»º...</p></div> : <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{projects.map((proj) => <ProjectCard key={proj.address} project={proj} currentBlock={currentBlock} />)}</div>}
                        </section>
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LaunchpadApp />);
    </script>
</body>
</html>